description: I'm writing to request the 8xA100 to process the data.

target:
  service: singularity
  name: palisades33
  workspace_name: azmlws2igshare

environment:
  image: amlt-sing/acpt-torch2.7.1-py3.10-cuda12.6-ubuntu22.04
  

storage:
  my_storage:
    storage_account_name: igshare
    container_name: v-zhifeng
    mount_dir: /scratch/v-zhifeng
  
code:
  local_dir: /home/v-zhifeng/HPE/openpi/
  ignore:
    - agibotworld
    - .venv/
    - data/
    - checkpoints/
    - old_scripts/
    
jobs:
- name: pi05_ft_static_bs512_40G8-A100_4nodes_IB
  sku: 4x40G8-A100-IB-NvLink
  priority: high
  preemptible: False
  identity: managed
  process_count_per_node: 1
  command:
  - sudo apt-get update
  - sudo apt-get install -y libglib2.0-0 libgl1 libsm6 libxext6 libxrender1
  - cd /scratch/amlt_code/
  - curl -L "https://aka.ms/downloadazcopy-v10-linux" -o azcopy_v10.tar.gz
  - tar -xzf azcopy_v10.tar.gz
  - cd azcopy_linux_amd64_*
  - sudo mv azcopy /scratch/amlt_code/
  - cd /scratch/amlt_code/
  - pip install nvitop
  - sudo apt-get update && sudo apt-get install -y vim
  - bash setup_env.sh
  - source ~/.local/bin/env
  - bash batch_azcopy.sh
  - mkdir -p /scratch/amlt_code/data
  - mkdir -p /scratch/amlt_code/checkpoints
  - ln -s /scratch/amlt_code/agibot_beta_split_500_resize_224/* /scratch/amlt_code/data/
  - ln -s /scratch/v-zhifeng/openpi/checkpoints/* /scratch/amlt_code/checkpoints/
  - >
    cd /scratch/amlt_code &&
    export WANDB_API_KEY=994cd7b5e79dffcab948d9a69766810153a12b48 &&
    export WANDB_ENTITY=aaronfeng24 &&
    EXP_NAME_ENV="pi05_ft_agibot_static_1212_HSDP_formal" bash ./scripts/train_jax.sh 512
  - sleep infinity


    # cd /scratch/amlt_code &&
    # export WANDB_API_KEY=994cd7b5e79dffcab948d9a69766810153a12b48 &&
    # export WANDB_ENTITY=aaronfeng24 &&
    # EXP_NAME_ENV="pi05_ft_agibot_static_1210_test" bash ./scripts/train_jax_multinodes.sh 512 "pi05_ft_agibot_static_1210_test_bs512_lr5e-5_step1000000"



  # - mkdir -p /scratch/amlt_code/data
  # - mkdir -p /scratch/amlt_code/checkpoints
  # - ln -s /scratch/v-zhifeng/agibot_beta_split_500_resize_224/* /scratch/amlt_code/data/
  # - ln -s /scratch/v-zhifeng/openpi/checkpoints/* /scratch/amlt_code/checkpoints/